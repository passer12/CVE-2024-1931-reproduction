#!/bin/bash

# 输出开始测试的消息
echo "start testing"

# 定义要执行的命令
COMMAND="dig ds-bogus-digest-value.extended-dns-errors.com @127.0.0.1 +dnssec +bufsize=512 +cd"

# 执行并输出命令和结果
echo "运行命令 $COMMAND"
RESULT=$(timeout 10s $COMMAND)
echo "$RESULT"

# 等待12秒
echo "等待12秒"
sleep 12

# 再次执行命令并输出结果
echo "再次运行 $COMMAND"
RESULT=$(timeout 12s $COMMAND)
echo "$RESULT"

# 检查命令执行是否超时或返回错误内容
if [[ $? -ne 0 || "$RESULT" == *"communications error to 127.0.0.1#53"* ]]; then
    echo "可能成功了，请手动检查日志"
else
    echo "测试失败，请手动检查日志"
fi
